{% extends 'base.html.twig' %}

{% block title %}Fagots{% endblock %}

{% block body %}
	<main>
    <section class="titre">
        <h1>Fagots</h1>
    </section>
    
    <section>
		<div class="allitems">
        {# boucle pour afficher tout les produits de type fagots #}
            {% for item in fagots %}
                <form class="formitem" action="{{ path('cart_add', { id: item.id }) }}" method="post">
			    <div class="items">
                    <h1>{{ item.name }}</h1>
                    <p class="test">{{ item.description }}</p>
                    <div class="others">
                        <label>Longueur</label>
                        <select class="longueurSelect">
                            {% if item.premierelongueur is not null and item.premierelongueur is not empty %}
                                <option value="{{ item.surplacepremierprix }}">{{ item.premierelongueur }}</option>
                            {% endif %}
                            {% if item.deuxiemelongueur is not null and item.deuxiemelongueur is not empty %}
                                <option value="{{ item.surplacedeuxiemeprix }}">{{ item.deuxiemelongueur }}</option>
                            {% endif %}
                            {% if item.troisiemelongueur is not null and item.troisiemelongueur is not empty %}
                                <option value="{{ item.surplacetroisiemeprix }}">{{ item.troisiemelongueur }}</option>
                            {% endif %}
                        </select>
                        <label>Livraison</label>
                        <select class="livraisonSelect">
                            {% if item.surplace is not null and item.surplace is not empty %}
                                <option value="{{ item.livraisonpremierprix }}">{{ item.surplace }}</option>
                            {% endif %}
                            {% if item.livraison is not null and item.livraison is not empty %}
                                <option value="{{ item.livraisondeuxiemeprix }}">{{ item.livraison }}</option>
                            {% endif %}
                        </select>
                        <label>Quantité</label>
                        <input type="number" name="quantite" class="quantite">
                        <p name="priceDisplay" class="priceDisplay">Prix : 0 €</p>
                        <input type="hidden" name="prixfinal" class="prixfinal">
    			        <button type="submit">Commander</button>
                    </div>
                </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const livraisonSelects = document.querySelectorAll(".livraisonSelect");
                const longueurSelects = document.querySelectorAll(".longueurSelect");
                const quantiteInputs = document.querySelectorAll(".quantite");
                const priceDisplay = document.querySelectorAll(".priceDisplay");

                livraisonSelects.forEach((livraisonSelect, index) => {
                    livraisonSelect.addEventListener("change", function () {
                        updateLongueurOptions(index);
                        updatePrice(index);
                    });
                });

                longueurSelects.forEach((longueurSelect, index) => {
                    longueurSelect.addEventListener("change", () => updatePrice(index));
                });

                quantiteInputs.forEach((quantiteInput, index) => {
                    quantiteInput.addEventListener("input", () => updatePrice(index));
                });



                function updatePrice(index) {
					const selectOptionLongueur = parseFloat(longueurSelects[index].value);
					const quantite = parseInt(quantiteInputs[index].value) || 0;
					const prixUnitaire = selectOptionLongueur;
					
					const totalPrice = prixUnitaire * quantite;

					priceDisplay[index].textContent = totalPrice.toFixed(2) + " €";

					const prixfinal = document.querySelectorAll(".prixfinal")[index];
					prixfinal.value = prixUnitaire;
				}

                // change le prix si l'utilisateur choisi l'option Livraison
                function updateLongueurOptions(index) {
                    const selectedLivraisonValue = livraisonSelects[index].value;

                    if (selectedLivraisonValue === "{{ item.livraisonpremierprix }}") {
                        longueurSelects[index].innerHTML = `
                            {% if item.premierelongueur is not null and item.premierelongueur is not empty %}
                                <option value="{{ item.surplacepremierprix }}">{{ item.premierelongueur }}</option>
                            {% endif %}
                            {% if item.deuxiemelongueur is not null and item.deuxiemelongueur is not empty %}
                                <option value="{{ item.surplacedeuxiemeprix }}">{{ item.deuxiemelongueur }}</option>
                            {% endif %}
                            {% if item.troisiemelongueur is not null and item.troisiemelongueur is not empty %}
                                <option value="{{ item.surplacetroisiemeprix }}">{{ item.troisiemelongueur }}</option>
                            {% endif %}
                        `;
                    } else if (selectedLivraisonValue === "{{ item.livraisondeuxiemeprix }}") {
                        longueurSelects[index].innerHTML = `
                            {% if item.premierelongueur is not null and item.premierelongueur is not empty %}
                                <option value="{{ item.livraisonpremierprix }}">{{ item.premierelongueur }}</option>
                            {% endif %}
                            {% if item.deuxiemelongueur is not null and item.deuxiemelongueur is not empty %}
                                <option value="{{ item.livraisondeuxiemeprix }}">{{ item.deuxiemelongueur }}</option>
                            {% endif %}
                            {% if item.troisiemelongueur is not null and item.troisiemelongueur is not empty %}
                                <option value="{{ item.livraisontroisiemeprix }}">{{ item.troisiemelongueur }}</option>
                            {% endif %}
                        `;
                    }
                }
            });
        </script>

				</form>
    {% endfor %}
</div>
		</section>

		</section>

    <section class="fagotsitems">
        <p>Bois Guilbaud vous propose du petit bois d’allumage à la bûche traditionnelle en divers
            conditionnement. Nous avons forcément la solution à votre besoin.
        </p>
    </section>
    <section class="demande">
        <p style="color:white;">Sac d’allume-feux naturel en filet. Démarrer facilement votre cheminée,
            poêle ou bien encore insert grâce à nos éclats de bois maison, issus du tri après la
            transformation de nos billons de bois en bûche, mais également de notre machine de production
            spécifique. Existe en 20 et 50 litres.
        </p>
        <p style="color:#f6b730">Chez nous c'est un vrai volume !! 20 litres 4 € / 50 litres 7 €<br>
            Pour l'achat de 5 sacs le 6ème est offert.
        </p>
    </section>
    </main>
{% endblock %}
